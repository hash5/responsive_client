<!DOCTYPE html>
<head>
    <title>Unit Tests - hash5.ds</title>
    <script src="../../../../closure-library/closure/goog/base.js"></script>
    <script src="../../deps.js"></script>
</head>
<body>
    <script>
        goog.require('hash5.ds.Recommondations');

        goog.require('goog.testing.jsunit');
        goog.require('goog.testing.AsyncTestCase');
        goog.require('hash5.controller.UserController');
        goog.require('hash5.model.Entry');
    </script>
    <script>
        var asyncTestCase = goog.testing.AsyncTestCase.createAndInstall();

        /** @type {hash5.ds.Recommondations} */
        var rec = hash5.ds.Recommondations.getInstance();

        function testAEnsureLogin()
        {
            asyncTestCase.waitForAsync('wait for login and data preparation');

            var userController = hash5.controller.UserController.getInstance();

            goog.events.listen(userController, hash5.controller.UserController.EventType.LOGIN, function(){

                // insert test data:
                var testEntry = new hash5.model.Entry();
                testEntry.setText('#test tag for recommondation');
                testEntry.save(function(){
                    asyncTestCase.continueTesting();
                });
            });

            userController.login('testUser', 'testPass');
        }

        function testBAutocomplete()
        {
            asyncTestCase.waitForAsync('wait for callback');

            rec.autocomplete('test text', 'tes', function(suggests){
                assert(goog.isArray(suggests));
                assert(goog.array.contains(suggests, '#test'));

                asyncTestCase.continueTesting();
            });
        }

        function testCAutocompleteErr()
        {
            asyncTestCase.waitForAsync('wait for callback');

            try{
                rec.autocomplete('test text', 'te', function(suggests){
                    fail('there is no autocomplete for less than 3 characters');
                    asyncTestCase.continueTesting();
                });
                fail('there is no autocomplete for less than 3 characters');
            }catch (ex){
                asyncTestCase.continueTesting();
            }

        }

        function testDRecommend()
        {
            asyncTestCase.waitForAsync('wait for callback');

            rec.autocomplete('test text', 'tes', function(suggests){
                assert(goog.isArray(suggests));
                assert(goog.array.contains(suggests, '#test'));

                asyncTestCase.continueTesting();
            });
        }
    </script>
</body>
</html>